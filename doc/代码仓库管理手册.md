# 代码仓库维护手册

[TOC]

### 一、基本操作说明（略）

pull

stage

commit

push

merge（squash）

rebase（注意和merge的区别）

branch

checkout

![4334c21fa212e06fd8351b68f798e8ac.png](https://img-blog.csdnimg.cn/img_convert/4334c21fa212e06fd8351b68f798e8ac.png)





### 二、分支（branch）设置规范

- `master`分支（**主发布分支，常设且唯一，只接受合并**）：
  - 项目的主发布分支，有且仅有一个，要经过严格测试确保稳定性
  - 一般由release分支或hotfix分支合并，避免直接修改代码提交
  - 每一个提交附带一个tag（stable-x.x.x），标记发行版本
- `develop`分支（**主开发分支，常设且唯一，只接受合并**）：
  - 项目的主开发分支，始终保持最新的bugfree的代码，同样只做合并操作，避免直接修改代码
  - 开发新功能时，从此分支最新提交开辟新的feature分支，完成新功能后再并入此分支
  - 团队成员应及时同步develop最新更新，在合并feature分支前确保与develop最新提交兼容
- `release`分支（**预发布分支，一次性，只接受合并**）：
  - 预发布版/提测分支，基于develop分支创建，完成测试后可以并入main
  - 一旦打了release分支之后不要从develop分支上合并新的改动到release分支
  - 发布release时，将其合并至main并打上tag，而后删除该分支
- `feature`分支（**个人开发分支，一次性，不唯一**）：
  - 由个人维护的特性开发分支，从develop最新提交创建，每人可同时维护多个
  - 建议在本地频繁提交更新，注意及时同步develop的最新更新
  - 稳定后，统一通过merge(squash)操作并入远端develop分支（**先通知其他人**）
  - 分支命名规范：**feat-计划添加的特性-by-Name**
- `hotfix`分支（**临时性，完成修复后及时删除**）：
  - 从master/develop分支上创建的（紧急）bug修复分支，fix完成后并入develop或master分支上，而后删除
  - 分支命名规范：**fix-需要解决的问题-by-Name**

![在这里插入图片描述](https://img-blog.csdnimg.cn/2c82d941ceba49cf99fd3157ec80dcf1.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5LmU5Lyf6bmP,size_20,color_FFFFFF,t_70,g_se,x_16)

### 三、提交（commit）命名规范

#### 3.1 基本格式

```html
<type>(<scope>): <header>		<!-- 标题行（必填），描述修改类型和主要内容，注意英文冒号和其之后的空格 -->
```

```html
[<body>]						<!-- 主题内容（可选），详细阐述why、what、how等等 -->

[<footer>]						<!-- 页脚注释（可选） -->
```

注：建议采用祈使句，即以某个动词开头；首字母不要大写；结尾不必加标点



#### 3.2 Type：提交类型

**必填**，可选类型如下：

| Type     | 适用提交内容             | 适用分支               |
| :------- | ------------------------ | ---------------------- |
| feat     | 新功能、新特性           | feature/develop        |
| test     | 测试功能、修改测试用例   | feature/hotfix         |
| fix      | 修复Bug                  | feature/develop/hotfix |
| perf     | 性能优化                 | feature/develop        |
| refactor | 代码重构                 | feature/develop        |
| docs     | 修改文档或注释           | feature/develop        |
| style    | 调整（或整理）代码风格   | feature/develop        |
| build    | 调整项目依赖项或构建方式 | develop                |
| release  | 稳定版发布               | release/master         |
| chore    | 不在上述类型中的提交     | all                    |



#### 3.3 Scope：影响范围

**必填**，填写commit的影响范围，例如：global, components, utils等。约定填写**包含所有修改文件的最小一级的文件夹或文件名**。

#### 3.4 Header：提交概述

**必填**，一句话描述提交所做的修改，**言简意赅**即可。

#### 3.5 Body：提交明细

**可选**，当一次性提交的**修改内容较多**或者涉及到的部分**比较关键**时，建议在此详细列出各修改点

#### 3.6 Footer：提交脚注

可选，注意与Body间隔一个空行，一些**备注**或者需要**强调**的东西



#### 3.7 示例：

```
feat(utils): 添加Types2D，集成一些二维集合类型
```

```
fix(components): 修复设计工作空间渲染错误的Bug

1、修复关联线错位问题；
2、修复画布元素。

!important: 结点渲染接口做了……调整
```



### 四、一般工作流程

#### 4.1 个人开发分支

- 当需要开发新特性时，从develop分支上创建新分支，并将分支命名为（feat-xxx-by-Name）


```
git checkout -b feat-aim-by-Name develop
```

- 在此分支上进行修改和提交，提交（commit）命名参照手册第二部分
- 当develop分支有更新时及时同步（使用rebase将feature分支变基到develop最新提交之上）

```c
git checkout feat-aim-by-Name	// 确保在个人开发分支上进行操作
git rebase develop
git push -f						// 因为本地commit记录相比远端记录整体发生了迁移，需要强push
```

- 当正在开发的功能达到相对稳定时及时并入develop分支（合并前**先通知其他人**）

- 及时在本地新建新的feature分支，避免不小心在develop等受保护分支上修改或提交

```
git checkout -b feat-new-by-Name develop
```

- 远端默认删除已经合并的feature分支，本地可根据个人意愿决定是否留存，如要删除，可执行

```
git branch -d feat-aim-by-Name
```



#### 4.2 全局修改流程

- 不建议在个人开发分支上修改全局依赖，因为全局依赖的修改需要尽快并入develop分支
- 在当前develop分支基础上新建feature分支（每个人可以同时维护多个feature分支）
- 在新的fearure分支上完成全局的修改，测试后尽快并入develop分支，并提醒其他人更新

#### 4.3 Bug紧急修复

- 在develop/release/master分支上遇到Bug时，可以新建一个hotfix分支解决，大致流程同上

#### 4.4 正式版发布

- develop分支更新到一定阶段时，可以在develop基础上创建release分支，进行进一步的测试
- 测试期间，release只接受hotfix的并入，达到稳定后可并入master分支并打上tag
- master分支上每个Commit均应拥有对应的tag，一般用于标记发行版本
- 通过merge request进行，尽量通过代码测试



### 五、其他问题讨论

#### 5.1 个人开发建议

- 鼓励本地分支频繁提交（commit）代码，分小功能提交，可以一天提交多次
- 鼓励频繁地使用分支与合并（提交merge request），注意遵循规范
- 个人开发工作应从开发主线分离开来，以免影响开发主线
